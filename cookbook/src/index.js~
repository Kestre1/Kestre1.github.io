// GLOBAL VARIABLES - storing DOM elements and preferred tags
// List to append entries to
var DOMContainer = null // (grabbed in amm_load_recipe_list())
var searchContainer = null // (grabbed in amm_search() first time)
// Tag names for link and container of recipe entry
var templateContainerTag = null;
var templateLinkTag = null;


async function amm_load_recipe_list(template=false) {
    /* amm_load_recipe_list()
       Loads and renders all recipes from local recipes.json file into the HTML DOM,
       from tag marked with id "amm_recipe_list" */

    // Get JSON
    const recipes = await get_JSON('recipes.json');
    // Get list tag to append to, and strip of template
    DOMContainer = document.getElementById('amm_recipe_list');

    // Grab template, if requested
    if (template) {
	// get tags in template
	const templateContainer = document.getElementById('amm_template_recipe_item_container');
	const templateLink = document.getElementById('amm_template_recipe_link');
	
	// get the template link tagname (not optional), and remove
	if (templateLink) {
	    templateLinkTag = templateLink.tagName;
	    templateLink.remove();
	} else {  // bad template; template must always have link
	    console.log("ERROR: amm_load_recipe_list(): template: template must have provided link tag.");
	}
	
	// if a container is provided (optional), save the tagname and remove
	if (templateContainer) {
	    templateContainerTag = templateContainer.tagName;
	    templateContainer.remove();
	} else {
	    templateContainerTag = null;  // for checking (obsolete now)
	}
    }
    else { // no template, use default <li> and <a> tags
	templateLinkTag = 'a';
	templateContainerTag = 'li';
    }

    for (recipeShortname in recipes) {
	_render_listing(recipes[recipeShortname], recipeShortname);
    }
}

function _render_listing(recipeJSON, recipeShortname, container=DOMContainer) {
    // create link tag (mandatory)
    const newRecipeLink = document.createElement(templateLinkTag);
    // update <a> tag for linking
    newRecipeLink.innerText = recipeJSON.name;
    newRecipeLink.href = ('07022024.html?recipe=' + recipeShortname);
    // if container specified, add to container and append to DOM
    if (templateContainerTag) {
	// create container item
	const newRecipeItem = document.createElement(templateContainerTag);
	// put link in container
	newRecipeItem.appendChild(newRecipeLink);
	// add container to DOM
	container.appendChild(newRecipeItem);
    }
    // no container, add link straight to DOM
    else { 
	container.appendChild(newRecipeLink);
    }
}

async function get_JSON(filename) {
    const response = await fetch(filename);
    const data = await response.json();
    return data;
}
